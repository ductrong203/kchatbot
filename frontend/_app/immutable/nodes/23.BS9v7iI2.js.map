{"version":3,"file":"23.BS9v7iI2.js","sources":["../../../../../../src/lib/components/notes/NotePanel.svelte","../../../../../../src/lib/components/notes/NoteEditor/Settings.svelte","../../../../../../src/lib/components/icons/ArrowUpLeft.svelte","../../../../../../src/lib/components/notes/NoteEditor/Chat/Message.svelte","../../../../../../src/lib/components/notes/NoteEditor/Chat/Messages.svelte","../../../../../../src/lib/components/notes/NoteEditor/Chat.svelte","../../../../../../src/lib/components/icons/Calendar.svelte","../../../../../../src/lib/components/icons/Users.svelte","../../../../../../src/lib/components/icons/Mic.svelte","../../../../../../src/lib/components/icons/CursorArrowRays.svelte","../../../../../../src/lib/components/notes/RecordMenu.svelte","../../../../../../src/lib/components/icons/SparklesSolid.svelte","../../../../../../src/lib/components/icons/ArrowUturnLeft.svelte","../../../../../../src/lib/components/icons/ArrowUturnRight.svelte","../../../../../../src/lib/components/notes/AIMenu.svelte","../../../../../../src/lib/components/notes/NoteEditor.svelte","../../../../../../src/routes/(app)/notes/[id]/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { onDestroy, onMount, tick } from 'svelte';\n\timport { Pane, PaneResizer } from 'paneforge';\n\n\timport Drawer from '../common/Drawer.svelte';\n\timport EllipsisVertical from '../icons/EllipsisVertical.svelte';\n\n\texport let show = false;\n\texport let pane = null;\n\n\texport let containerId = 'note-container';\n\n\tlet mediaQuery;\n\tlet largeScreen = false;\n\n\tlet minSize = 0;\n\n\tconst handleMediaQuery = async (e) => {\n\t\tif (e.matches) {\n\t\t\tlargeScreen = true;\n\t\t} else {\n\t\t\tlargeScreen = false;\n\t\t\tpane = null;\n\t\t}\n\t};\n\n\tonMount(() => {\n\t\t// listen to resize 1000px\n\t\tmediaQuery = window.matchMedia('(min-width: 1000px)');\n\n\t\tmediaQuery.addEventListener('change', handleMediaQuery);\n\t\thandleMediaQuery(mediaQuery);\n\n\t\t// Select the container element you want to observe\n\t\tconst container = document.getElementById(containerId);\n\n\t\t// initialize the minSize based on the container width\n\t\tminSize = Math.floor((400 / container.clientWidth) * 100);\n\n\t\t// Create a new ResizeObserver instance\n\t\tconst resizeObserver = new ResizeObserver((entries) => {\n\t\t\tfor (let entry of entries) {\n\t\t\t\tconst width = entry.contentRect.width;\n\t\t\t\t// calculate the percentage of 200px\n\t\t\t\tconst percentage = (400 / width) * 100;\n\t\t\t\t// set the minSize to the percentage, must be an integer\n\t\t\t\tminSize = Math.floor(percentage);\n\n\t\t\t\tif (show) {\n\t\t\t\t\tif (pane && pane.isExpanded() && pane.getSize() < minSize) {\n\t\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Start observing the container's size changes\n\t\tresizeObserver.observe(container);\n\t});\n\n\tonDestroy(() => {\n\t\tmediaQuery.removeEventListener('change', handleMediaQuery);\n\t});\n</script>\n\n{#if !largeScreen}\n\t{#if show}\n\t\t<Drawer\n\t\t\t{show}\n\t\t\tonClose={() => {\n\t\t\t\tshow = false;\n\t\t\t}}\n\t\t>\n\t\t\t<div class=\" px-3.5 py-2.5 h-screen max-h-dvh flex flex-col\">\n\t\t\t\t<slot />\n\t\t\t</div>\n\t\t</Drawer>\n\t{/if}\n{:else if show}\n\t<PaneResizer\n\t\tclass=\"relative flex w-2 items-center justify-center bg-background group bg-white dark:shadow-lg dark:bg-gray-850 border-l border-gray-50 dark:border-gray-850\"\n\t>\n\t\t<div class=\"z-10 flex h-7 w-5 items-center justify-center rounded-xs\">\n\t\t\t<EllipsisVertical className=\"size-4 invisible group-hover:visible\" />\n\t\t</div>\n\t</PaneResizer>\n\n\t<Pane\n\t\tbind:pane\n\t\tdefaultSize={Math.max(20, minSize)}\n\t\t{minSize}\n\t\tonCollapse={() => {\n\t\t\tshow = false;\n\t\t}}\n\t\tcollapsible={true}\n\t\tclass=\" z-10 \"\n\t>\n\t\t{#if show}\n\t\t\t<div class=\"flex max-h-full min-h-full\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-full pl-1.5 pr-2.5 pt-2 bg-white dark:shadow-lg dark:bg-gray-850 z-40 pointer-events-auto overflow-y-auto scrollbar-hidden flex flex-col\"\n\t\t\t\t>\n\t\t\t\t\t<slot />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</Pane>\n{/if}\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport { models } from '$lib/stores';\n\n\texport let show = false;\n\texport let selectedModelId = '';\n</script>\n\n<div class=\"flex items-center mb-1.5 pt-1.5\">\n\t<div class=\" -translate-x-1.5 flex items-center\">\n\t\t<button\n\t\t\tclass=\"p-0.5 bg-transparent transition rounded-lg\"\n\t\t\ton:click={() => {\n\t\t\t\tshow = !show;\n\t\t\t}}\n\t\t>\n\t\t\t<XMark className=\"size-5\" strokeWidth=\"2.5\" />\n\t\t</button>\n\t</div>\n\n\t<div class=\" font-medium text-base flex items-center gap-1\">\n\t\t<div>\n\t\t\t{$i18n.t('Settings')}\n\t\t</div>\n\t</div>\n</div>\n\n<div class=\"mt-1\">\n\t<div>\n\t\t<div class=\" text-xs font-medium mb-1\">Model</div>\n\n\t\t<div class=\"w-full\">\n\t\t\t<select class=\"w-full bg-transparent text-sm outline-hidden\" bind:value={selectedModelId}>\n\t\t\t\t<option value=\"\" class=\"bg-gray-50 dark:bg-gray-700\" disabled>\n\t\t\t\t\t{$i18n.t('Select a model')}\n\t\t\t\t</option>\n\t\t\t\t{#each $models.filter((model) => !(model?.info?.meta?.hidden ?? false)) as model}\n\t\t\t\t\t<option value={model.id} class=\"bg-gray-50 dark:bg-gray-700\">{model.name}</option>\n\t\t\t\t{/each}\n\t\t\t</select>\n\t\t</div>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"m19.5 19.5-15-15m0 0v11.25m0-11.25h11.25\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { onMount, getContext } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\n\timport Skeleton from '$lib/components/chat/Messages/Skeleton.svelte';\n\timport Markdown from '$lib/components/chat/Messages/Markdown.svelte';\n\timport Pencil from '$lib/components/icons/Pencil.svelte';\n\timport Textarea from '$lib/components/common/Textarea.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport ArrowUpLeft from '$lib/components/icons/ArrowUpLeft.svelte';\n\n\texport let message;\n\texport let idx;\n\n\texport let onDelete;\n\texport let onEdit;\n\texport let onInsert;\n\n\tlet textAreaElement: HTMLTextAreaElement;\n</script>\n\n<div class=\"flex flex-col gap-1 group\">\n\t<div class=\"flex items-center justify-between pt-1\">\n\t\t<div class=\"py-1 text-sm font-semibold uppercase min-w-[6rem] text-left rounded-lg transition\">\n\t\t\t{$i18n.t(message.role)}\n\t\t</div>\n\n\t\t<div class=\"flex items-center gap-2\">\n\t\t\t<Tooltip placement=\"top\" content={$i18n.t('Insert')}>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" text-transparent group-hover:text-gray-500 dark:hover:text-gray-300 transition\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tonInsert();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<ArrowUpLeft className=\"size-3.5\" strokeWidth=\"2\" />\n\t\t\t\t</button>\n\t\t\t</Tooltip>\n\n\t\t\t<Tooltip placement=\"top\" content={$i18n.t('Edit')}>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" text-transparent group-hover:text-gray-500 dark:hover:text-gray-300 transition\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tonEdit();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<Pencil className=\"size-3.5\" strokeWidth=\"2\" />\n\t\t\t\t</button>\n\t\t\t</Tooltip>\n\n\t\t\t<Tooltip placement=\"top\" content={$i18n.t('Delete')}>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" text-transparent group-hover:text-gray-500 dark:hover:text-gray-300 transition\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tonDelete();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\td=\"M15 12H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</Tooltip>\n\t\t</div>\n\t</div>\n\n\t<div class=\"flex-1\">\n\t\t<!-- $i18n.t('a user') -->\n\t\t<!-- $i18n.t('an assistant') -->\n\n\t\t{#if !(message?.done ?? true) && message?.content === ''}\n\t\t\t<div class=\"\">\n\t\t\t\t<Skeleton size=\"sm\" />\n\t\t\t</div>\n\t\t{:else if message?.edit === true}\n\t\t\t<Textarea\n\t\t\t\tclassName=\"w-full bg-transparent outline-hidden text-sm resize-none overflow-hidden\"\n\t\t\t\tplaceholder={$i18n.t(`Enter {{role}} message here`, {\n\t\t\t\t\trole: message.role === 'user' ? $i18n.t('a user') : $i18n.t('an assistant')\n\t\t\t\t})}\n\t\t\t\tbind:value={message.content}\n\t\t\t\tonBlur={() => {\n\t\t\t\t\tmessage.edit = false;\n\t\t\t\t}}\n\t\t\t/>\n\t\t{:else}\n\t\t\t<div class=\" markdown-prose-sm text-sm\">\n\t\t\t\t<Markdown id={`note-message-${idx}`} content={message.content} />\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { onMount, getContext } from 'svelte';\n\timport Message from './Message.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let messages = [];\n\texport let onInsert = (content: string) => {};\n</script>\n\n<div class=\"space-y-3 pb-12\">\n\t{#each messages as message, idx}\n\t\t<Message\n\t\t\t{message}\n\t\t\t{idx}\n\t\t\tonInsert={() => {\n\t\t\t\tonInsert(message?.content ?? '');\n\t\t\t}}\n\t\t\tonEdit={() => {\n\t\t\t\tmessages = messages.map((msg, messageIdx) => {\n\t\t\t\t\tif (messageIdx === idx) {\n\t\t\t\t\t\treturn { ...msg, edit: true };\n\t\t\t\t\t}\n\t\t\t\t\treturn msg;\n\t\t\t\t});\n\t\t\t}}\n\t\t\tonDelete={() => {\n\t\t\t\tmessages = messages.filter((message, messageIdx) => messageIdx !== idx);\n\t\t\t}}\n\t\t/>\n\t{/each}\n</div>\n","<script lang=\"ts\">\n\texport let show = false;\n\texport let selectedModelId = '';\n\n\timport { marked } from 'marked';\n\t// Configure marked with extensions\n\tmarked.use({\n\t\tbreaks: true,\n\t\tgfm: true,\n\t\trenderer: {\n\t\t\tlist(body, ordered, start) {\n\t\t\t\tconst isTaskList = body.includes('data-checked=');\n\n\t\t\t\tif (isTaskList) {\n\t\t\t\t\treturn `<ul data-type=\"taskList\">${body}</ul>`;\n\t\t\t\t}\n\n\t\t\t\tconst type = ordered ? 'ol' : 'ul';\n\t\t\t\tconst startatt = ordered && start !== 1 ? ` start=\"${start}\"` : '';\n\t\t\t\treturn `<${type}${startatt}>${body}</${type}>`;\n\t\t\t},\n\n\t\t\tlistitem(text, task, checked) {\n\t\t\t\tif (task) {\n\t\t\t\t\tconst checkedAttr = checked ? 'true' : 'false';\n\t\t\t\t\treturn `<li data-type=\"taskItem\" data-checked=\"${checkedAttr}\">${text}</li>`;\n\t\t\t\t}\n\t\t\t\treturn `<li>${text}</li>`;\n\t\t\t}\n\t\t}\n\t});\n\n\timport { toast } from 'svelte-sonner';\n\n\timport { goto } from '$app/navigation';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport {\n\t\tOLLAMA_API_BASE_URL,\n\t\tOPENAI_API_BASE_URL,\n\t\tWEBUI_API_BASE_URL,\n\t\tWEBUI_BASE_URL\n\t} from '$lib/constants';\n\timport { WEBUI_NAME, config, user, models, settings } from '$lib/stores';\n\n\timport { chatCompletion, generateOpenAIChatCompletion } from '$lib/apis/openai';\n\n\timport { splitStream } from '$lib/utils';\n\n\timport Messages from '$lib/components/notes/NoteEditor/Chat/Messages.svelte';\n\timport MessageInput from '$lib/components/channel/MessageInput.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Pencil from '$lib/components/icons/Pencil.svelte';\n\timport PencilSquare from '$lib/components/icons/PencilSquare.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let editing = false;\n\texport let streaming = false;\n\texport let stopResponseFlag = false;\n\n\texport let note = null;\n\n\texport let files = [];\n\texport let messages = [];\n\n\texport let onInsert = (content) => {};\n\texport let onStop = () => {};\n\texport let onEdited = () => {};\n\n\texport let insertNoteHandler = () => {};\n\texport let scrollToBottomHandler = () => {};\n\n\tlet loaded = false;\n\n\tlet loading = false;\n\n\tlet messagesContainerElement: HTMLDivElement;\n\n\tlet system = '';\n\tlet editorEnabled = false;\n\tlet chatInputElement = null;\n\n\tconst DEFAULT_DOCUMENT_EDITOR_PROMPT = `You are an expert document editor.\n\n## Task\nBased on the user's instruction, update and enhance the existing notes by incorporating relevant and accurate information from the provided context in the content's primary language. Ensure all edits strictly follow the user’s intent.\n\n## Input Structure\n- Existing notes: Enclosed within <notes></notes> XML tags.\n- Additional context: Enclosed within <context></context> XML tags.\n- Editing instruction: Provided in the user message.\n\n## Output Instructions\n- Deliver a single, rewritten version of the notes in markdown format.\n- Integrate information from the context only if it directly supports the user's instruction.\n- Use clear, organized markdown elements: headings, lists, task lists ([ ]) where tasks or checklists are strongly implied, bold and italic text as appropriate.\n- Focus on improving clarity, completeness, and usefulness of the notes.\n- Return only the final, fully-edited markdown notes—do not include explanations, reasoning, or XML tags.\n`;\n\n\tlet scrolledToBottom = true;\n\n\tconst scrollToBottom = () => {\n\t\tif (messagesContainerElement) {\n\t\t\tif (scrolledToBottom) {\n\t\t\t\tmessagesContainerElement.scrollTop = messagesContainerElement.scrollHeight;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst onScroll = () => {\n\t\tif (messagesContainerElement) {\n\t\t\tscrolledToBottom =\n\t\t\t\tmessagesContainerElement.scrollHeight - messagesContainerElement.scrollTop <=\n\t\t\t\tmessagesContainerElement.clientHeight + 10;\n\t\t}\n\t};\n\n\tconst chatCompletionHandler = async () => {\n\t\tif (selectedModelId === '') {\n\t\t\ttoast.error($i18n.t('Please select a model.'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = $models.find((model) => model.id === selectedModelId);\n\t\tif (!model) {\n\t\t\tselectedModelId = '';\n\t\t\treturn;\n\t\t}\n\n\t\tlet responseMessage;\n\t\tif (messages.at(-1)?.role === 'assistant') {\n\t\t\tresponseMessage = messages.at(-1);\n\t\t} else {\n\t\t\tresponseMessage = {\n\t\t\t\trole: 'assistant',\n\t\t\t\tcontent: '',\n\t\t\t\tdone: false\n\t\t\t};\n\t\t\tmessages.push(responseMessage);\n\t\t\tmessages = messages;\n\t\t}\n\n\t\tawait tick();\n\t\tscrollToBottom();\n\n\t\tstopResponseFlag = false;\n\t\tlet enhancedContent = {\n\t\t\tjson: null,\n\t\t\thtml: '',\n\t\t\tmd: ''\n\t\t};\n\n\t\tsystem = '';\n\n\t\tif (editorEnabled) {\n\t\t\tsystem = `${DEFAULT_DOCUMENT_EDITOR_PROMPT}\\n\\n`;\n\t\t} else {\n\t\t\tsystem = `You are a helpful assistant. Please answer the user's questions based on the context provided.\\n\\n`;\n\t\t}\n\n\t\tsystem +=\n\t\t\t`<notes>${note?.data?.content?.md ?? ''}</notes>` +\n\t\t\t(files && files.length > 0\n\t\t\t\t? `\\n<context>${files.map((file) => `${file.name}: ${file?.file?.data?.content ?? 'Could not extract content'}\\n`).join('')}</context>`\n\t\t\t\t: '');\n\n\t\tconst chatMessages = JSON.parse(\n\t\t\tJSON.stringify([\n\t\t\t\t{\n\t\t\t\t\trole: 'system',\n\t\t\t\t\tcontent: `${system}`\n\t\t\t\t},\n\t\t\t\t...messages\n\t\t\t])\n\t\t);\n\n\t\tconst [res, controller] = await chatCompletion(\n\t\t\tlocalStorage.token,\n\t\t\t{\n\t\t\t\tmodel: model.id,\n\t\t\t\tstream: true,\n\t\t\t\tmessages: chatMessages\n\t\t\t\t// ...(files && files.length > 0 ? { files } : {}) // TODO: Decide whether to use native file handling or not\n\t\t\t},\n\t\t\t`${WEBUI_BASE_URL}/api`\n\t\t);\n\n\t\tawait tick();\n\t\tscrollToBottom();\n\n\t\tlet messageContent = '';\n\n\t\tif (res && res.ok) {\n\t\t\tconst reader = res.body\n\t\t\t\t.pipeThrough(new TextDecoderStream())\n\t\t\t\t.pipeThrough(splitStream('\\n'))\n\t\t\t\t.getReader();\n\n\t\t\twhile (true) {\n\t\t\t\tconst { value, done } = await reader.read();\n\t\t\t\tif (done || stopResponseFlag) {\n\t\t\t\t\tif (stopResponseFlag) {\n\t\t\t\t\t\tcontroller.abort('User: Stop Response');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (editorEnabled) {\n\t\t\t\t\t\tediting = false;\n\t\t\t\t\t\tstreaming = false;\n\t\t\t\t\t\tonEdited();\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet lines = value.split('\\n');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line !== '') {\n\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\tif (line === 'data: [DONE]') {\n\t\t\t\t\t\t\t\tif (editorEnabled) {\n\t\t\t\t\t\t\t\t\tresponseMessage.content = `<status title=\"${$i18n.t('Edited')}\" done=\"true\" />`;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresponseMessage.done = true;\n\t\t\t\t\t\t\t\tmessages = messages;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlet data = JSON.parse(line.replace(/^data: /, ''));\n\t\t\t\t\t\t\t\tconsole.log(data);\n\n\t\t\t\t\t\t\t\tlet deltaContent = data.choices[0]?.delta?.content ?? '';\n\t\t\t\t\t\t\t\tif (responseMessage.content == '' && deltaContent == '\\n') {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (editorEnabled) {\n\t\t\t\t\t\t\t\t\t\tediting = true;\n\t\t\t\t\t\t\t\t\t\tstreaming = true;\n\n\t\t\t\t\t\t\t\t\t\tenhancedContent.md += deltaContent;\n\t\t\t\t\t\t\t\t\t\tenhancedContent.html = marked.parse(enhancedContent.md);\n\n\t\t\t\t\t\t\t\t\t\tnote.data.content.md = enhancedContent.md;\n\t\t\t\t\t\t\t\t\t\tnote.data.content.html = enhancedContent.html;\n\t\t\t\t\t\t\t\t\t\tnote.data.content.json = null;\n\n\t\t\t\t\t\t\t\t\t\tresponseMessage.content = `<status title=\"${$i18n.t('Editing')}\" done=\"false\" />`;\n\n\t\t\t\t\t\t\t\t\t\tscrollToBottomHandler();\n\t\t\t\t\t\t\t\t\t\tmessages = messages;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tmessageContent += deltaContent;\n\n\t\t\t\t\t\t\t\t\t\tresponseMessage.content = messageContent;\n\t\t\t\t\t\t\t\t\t\tmessages = messages;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t}\n\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst submitHandler = async (e) => {\n\t\tconst { content, data } = e;\n\t\tif (selectedModelId && content) {\n\t\t\tmessages.push({\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: content\n\t\t\t});\n\t\t\tmessages = messages;\n\n\t\t\tawait tick();\n\t\t\tscrollToBottom();\n\n\t\t\tloading = true;\n\t\t\tawait chatCompletionHandler();\n\t\t\tmessages = messages.map((message) => {\n\t\t\t\tmessage.done = true;\n\t\t\t\treturn message;\n\t\t\t});\n\n\t\t\tloading = false;\n\t\t\tstopResponseFlag = false;\n\t\t}\n\t};\n\n\tonMount(async () => {\n\t\tif ($user?.role !== 'admin') {\n\t\t\tawait goto('/');\n\t\t}\n\n\t\teditorEnabled = localStorage.getItem('noteEditorEnabled') === 'true';\n\n\t\tloaded = true;\n\n\t\tawait tick();\n\t\tscrollToBottom();\n\t});\n</script>\n\n<div class=\"flex items-center mb-1.5 pt-1.5\">\n\t<div class=\" -translate-x-1.5 flex items-center\">\n\t\t<button\n\t\t\tclass=\"p-0.5 bg-transparent transition rounded-lg\"\n\t\t\ton:click={() => {\n\t\t\t\tshow = !show;\n\t\t\t}}\n\t\t>\n\t\t\t<XMark className=\"size-5\" strokeWidth=\"2.5\" />\n\t\t</button>\n\t</div>\n\n\t<div class=\" font-medium text-base flex items-center gap-1\">\n\t\t<div>\n\t\t\t{$i18n.t('Chat')}\n\t\t</div>\n\n\t\t<div>\n\t\t\t<Tooltip\n\t\t\t\tcontent={$i18n.t(\n\t\t\t\t\t'This feature is experimental and may be modified or discontinued without notice.'\n\t\t\t\t)}\n\t\t\t\tposition=\"top\"\n\t\t\t\tclassName=\"inline-block\"\n\t\t\t>\n\t\t\t\t<span class=\"text-gray-500 text-sm\">({$i18n.t('Experimental')})</span>\n\t\t\t</Tooltip>\n\t\t</div>\n\t</div>\n</div>\n\n<div class=\"flex flex-col items-center mb-2 flex-1 @container\">\n\t<div class=\" flex flex-col justify-between w-full overflow-y-auto h-full\">\n\t\t<div class=\"mx-auto w-full md:px-0 h-full relative\">\n\t\t\t<div class=\" flex flex-col h-full\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\" pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 scrollbar-hidden\"\n\t\t\t\t\tid=\"messages-container\"\n\t\t\t\t\tbind:this={messagesContainerElement}\n\t\t\t\t\ton:scroll={onScroll}\n\t\t\t\t>\n\t\t\t\t\t<div class=\" h-full w-full flex flex-col\">\n\t\t\t\t\t\t<div class=\"flex-1 p-1\">\n\t\t\t\t\t\t\t<Messages bind:messages {onInsert} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\" pb-2\">\n\t\t\t\t\t<MessageInput\n\t\t\t\t\t\tbind:chatInputElement\n\t\t\t\t\t\tacceptFiles={false}\n\t\t\t\t\t\tinputLoading={loading}\n\t\t\t\t\t\tshowFormattingButtons={false}\n\t\t\t\t\t\tonSubmit={submitHandler}\n\t\t\t\t\t\t{onStop}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div slot=\"menu\" class=\"flex items-center justify-between gap-2 w-full pr-1\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Edit')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() => {\n\t\t\t\t\t\t\t\t\t\t\teditorEnabled = !editorEnabled;\n\n\t\t\t\t\t\t\t\t\t\t\tlocalStorage.setItem('noteEditorEnabled', editorEnabled ? 'true' : 'false');\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tclass=\"px-2 @xl:px-2.5 py-2 flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden hover:bg-gray-50 dark:hover:bg-gray-800 {editorEnabled\n\t\t\t\t\t\t\t\t\t\t\t? ' text-sky-500 dark:text-sky-300 bg-sky-50 dark:bg-sky-200/5'\n\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 '}\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<PencilSquare className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\tclass=\"block whitespace-nowrap overflow-hidden text-ellipsis leading-none pr-0.5\"\n\t\t\t\t\t\t\t\t\t\t\t>{$i18n.t('Edit')}</span\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<Tooltip content={selectedModelId}>\n\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\tclass=\" bg-transparent rounded-lg py-1 px-2 -mx-0.5 text-sm outline-hidden w-full text-right pr-5\"\n\t\t\t\t\t\t\t\t\tbind:value={selectedModelId}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#each $models as model}\n\t\t\t\t\t\t\t\t\t\t<option value={model.id} class=\"bg-gray-50 dark:bg-gray-700\"\n\t\t\t\t\t\t\t\t\t\t\t>{model.name}</option\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</MessageInput>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\texport let className = 'size-3';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-3';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { createEventDispatcher, getContext, onMount } from 'svelte';\n\n\timport { showSettings, mobile, showSidebar, user } from '$lib/stores';\n\timport { fade, slide } from 'svelte/transition';\n\n\timport Mic from '../icons/Mic.svelte';\n\timport CursorArrowRays from '../icons/CursorArrowRays.svelte';\n\timport DocumentArrowUp from '../icons/DocumentArrowUp.svelte';\n\timport CloudArrowUp from '../icons/CloudArrowUp.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\texport let className = 'max-w-[170px]';\n\n\texport let onRecord = () => {};\n\texport let onCaptureAudio = () => {};\n\texport let onUpload = () => {};\n\n\tconst dispatch = createEventDispatcher();\n</script>\n\n<DropdownMenu.Root\n\tbind:open={show}\n\tonOpenChange={(state) => {\n\t\tdispatch('change', state);\n\t}}\n>\n\t<DropdownMenu.Trigger>\n\t\t<slot />\n\t</DropdownMenu.Trigger>\n\n\t<slot name=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full {className} text-sm rounded-xl px-1 py-1.5 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg font-primary\"\n\t\t\tsideOffset={8}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"start\"\n\t\t\ttransition={(e) => fade(e, { duration: 100 })}\n\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"flex rounded-md py-1.5 px-3 w-full hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tonRecord();\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" self-center mr-2\">\n\t\t\t\t\t<Mic className=\"size-4\" strokeWidth=\"2\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\" self-center truncate\">{$i18n.t('Record')}</div>\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\tclass=\"flex rounded-md py-1.5 px-3 w-full hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonCaptureAudio();\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" self-center mr-2\">\n\t\t\t\t\t<CursorArrowRays className=\"size-4\" strokeWidth=\"2\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\" self-center truncate\">{$i18n.t('Capture Audio')}</div>\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\tclass=\"flex rounded-md py-1.5 px-3 w-full hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonUpload();\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" self-center mr-2\">\n\t\t\t\t\t<CloudArrowUp className=\"size-4\" strokeWidth=\"2\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\" self-center truncate\">{$i18n.t('Upload Audio')}</div>\n\t\t\t</button>\n\t\t</DropdownMenu.Content>\n\t</slot>\n</DropdownMenu.Root>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M9 4.5a.75.75 0 0 1 .721.544l.813 2.846a3.75 3.75 0 0 0 2.576 2.576l2.846.813a.75.75 0 0 1 0 1.442l-2.846.813a3.75 3.75 0 0 0-2.576 2.576l-.813 2.846a.75.75 0 0 1-1.442 0l-.813-2.846a3.75 3.75 0 0 0-2.576-2.576l-2.846-.813a.75.75 0 0 1 0-1.442l2.846-.813A3.75 3.75 0 0 0 7.466 7.89l.813-2.846A.75.75 0 0 1 9 4.5ZM18 1.5a.75.75 0 0 1 .728.568l.258 1.036c.236.94.97 1.674 1.91 1.91l1.036.258a.75.75 0 0 1 0 1.456l-1.036.258c-.94.236-1.674.97-1.91 1.91l-.258 1.036a.75.75 0 0 1-1.456 0l-.258-1.036a2.625 2.625 0 0 0-1.91-1.91l-1.036-.258a.75.75 0 0 1 0-1.456l1.036-.258a2.625 2.625 0 0 0 1.91-1.91l.258-1.036A.75.75 0 0 1 18 1.5ZM16.5 15a.75.75 0 0 1 .712.513l.394 1.183c.15.447.5.799.948.948l1.183.395a.75.75 0 0 1 0 1.422l-1.183.395c-.447.15-.799.5-.948.948l-.395 1.183a.75.75 0 0 1-1.422 0l-.395-1.183a1.5 1.5 0 0 0-.948-.948l-1.183-.395a.75.75 0 0 1 0-1.422l1.183-.395c.447-.15.799-.5.948-.948l.395-1.183A.75.75 0 0 1 16.5 15Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"m15 15 6-6m0 0-6-6m6 6H9a6 6 0 0 0 0 12h3\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { createEventDispatcher, getContext, onMount } from 'svelte';\n\n\timport { showSettings, mobile, showSidebar, user } from '$lib/stores';\n\timport { fade, slide } from 'svelte/transition';\n\n\timport PencilSquare from '../icons/PencilSquare.svelte';\n\timport ChatBubbleOval from '../icons/ChatBubbleOval.svelte';\n\timport Sparkles from '../icons/Sparkles.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\texport let className = 'max-w-[170px]';\n\n\texport let onEdit = () => {};\n\texport let onChat = () => {};\n\n\texport let onChange = () => {};\n</script>\n\n<DropdownMenu.Root bind:open={show} onOpenChange={onChange}>\n\t<DropdownMenu.Trigger>\n\t\t<slot />\n\t</DropdownMenu.Trigger>\n\n\t<slot name=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full {className} text-sm rounded-xl px-1 py-1.5 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg font-primary\"\n\t\t\tsideOffset={8}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"end\"\n\t\t\ttransition={(e) => fade(e, { duration: 100 })}\n\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"flex rounded-md py-1.5 px-3 w-full hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tonEdit();\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" self-center mr-2\">\n\t\t\t\t\t<Sparkles className=\"size-4\" strokeWidth=\"2\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\" self-center truncate\">{$i18n.t('Enhance')}</div>\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\tclass=\"flex rounded-md py-1.5 px-3 w-full hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonChat();\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" self-center mr-2\">\n\t\t\t\t\t<ChatBubbleOval className=\"size-4\" strokeWidth=\"2\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\" self-center truncate\">{$i18n.t('Chat')}</div>\n\t\t\t</button>\n\t\t</DropdownMenu.Content>\n\t</slot>\n</DropdownMenu.Root>\n","<script lang=\"ts\">\n\timport { getContext, onDestroy, onMount, tick } from 'svelte';\n\timport { v4 as uuidv4 } from 'uuid';\n\timport heic2any from 'heic2any';\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport jsPDF from 'jspdf';\n\timport html2canvas from 'html2canvas-pro';\n\n\tconst i18n = getContext('i18n');\n\n\timport { marked } from 'marked';\n\timport { toast } from 'svelte-sonner';\n\n\timport { goto } from '$app/navigation';\n\n\timport dayjs from '$lib/dayjs';\n\timport calendar from 'dayjs/plugin/calendar';\n\timport duration from 'dayjs/plugin/duration';\n\timport relativeTime from 'dayjs/plugin/relativeTime';\n\n\tdayjs.extend(calendar);\n\tdayjs.extend(duration);\n\tdayjs.extend(relativeTime);\n\n\timport { PaneGroup, Pane, PaneResizer } from 'paneforge';\n\n\timport { compressImage, copyToClipboard, splitStream } from '$lib/utils';\n\timport { WEBUI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\n\timport { uploadFile } from '$lib/apis/files';\n\timport { chatCompletion, generateOpenAIChatCompletion } from '$lib/apis/openai';\n\n\timport { config, models, settings, showSidebar, socket, user, WEBUI_NAME } from '$lib/stores';\n\n\timport NotePanel from '$lib/components/notes/NotePanel.svelte';\n\timport MenuLines from '../icons/MenuLines.svelte';\n\timport ChatBubbleOval from '../icons/ChatBubbleOval.svelte';\n\timport Settings from './NoteEditor/Settings.svelte';\n\timport Chat from './NoteEditor/Chat.svelte';\n\timport AccessControlModal from '$lib/components/workspace/common/AccessControlModal.svelte';\n\n\tasync function loadLocale(locales) {\n\t\tfor (const locale of locales) {\n\t\t\ttry {\n\t\t\t\tdayjs.locale(locale);\n\t\t\t\tbreak; // Stop after successfully loading the first available locale\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(`Could not load locale '${locale}':`, error);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Assuming $i18n.languages is an array of language codes\n\t$: loadLocale($i18n.languages);\n\n\timport { deleteNoteById, getNoteById, updateNoteById } from '$lib/apis/notes';\n\n\timport RichTextInput from '../common/RichTextInput.svelte';\n\timport Spinner from '../common/Spinner.svelte';\n\timport MicSolid from '../icons/MicSolid.svelte';\n\timport VoiceRecording from '../chat/MessageInput/VoiceRecording.svelte';\n\timport DeleteConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\n\n\timport Calendar from '../icons/Calendar.svelte';\n\timport Users from '../icons/Users.svelte';\n\n\timport Image from '../common/Image.svelte';\n\timport FileItem from '../common/FileItem.svelte';\n\timport FilesOverlay from '../chat/MessageInput/FilesOverlay.svelte';\n\timport RecordMenu from './RecordMenu.svelte';\n\timport NoteMenu from './Notes/NoteMenu.svelte';\n\timport EllipsisHorizontal from '../icons/EllipsisHorizontal.svelte';\n\timport Sparkles from '../icons/Sparkles.svelte';\n\timport SparklesSolid from '../icons/SparklesSolid.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Bars3BottomLeft from '../icons/Bars3BottomLeft.svelte';\n\timport ArrowUturnLeft from '../icons/ArrowUturnLeft.svelte';\n\timport ArrowUturnRight from '../icons/ArrowUturnRight.svelte';\n\timport Sidebar from '../common/Sidebar.svelte';\n\timport ArrowRight from '../icons/ArrowRight.svelte';\n\timport Cog6 from '../icons/Cog6.svelte';\n\timport AiMenu from './AIMenu.svelte';\n\n\texport let id: null | string = null;\n\n\tlet editor = null;\n\tlet note = null;\n\n\tconst newNote = {\n\t\ttitle: '',\n\t\tdata: {\n\t\t\tcontent: {\n\t\t\t\tjson: null,\n\t\t\t\thtml: '',\n\t\t\t\tmd: ''\n\t\t\t},\n\t\t\tversions: [],\n\t\t\tfiles: null\n\t\t},\n\t\t// pages: [], // TODO: Implement pages for notes to allow users to create multiple pages in a note\n\t\tmeta: null,\n\t\taccess_control: {}\n\t};\n\n\tlet files = [];\n\tlet messages = [];\n\n\tlet wordCount = 0;\n\tlet charCount = 0;\n\n\tlet versionIdx = null;\n\tlet selectedModelId = null;\n\n\tlet recording = false;\n\tlet displayMediaRecord = false;\n\n\tlet showPanel = false;\n\tlet selectedPanel = 'chat';\n\n\tlet showDeleteConfirm = false;\n\tlet showAccessControlModal = false;\n\n\tlet titleInputFocused = false;\n\tlet titleGenerating = false;\n\n\tlet dragged = false;\n\tlet loading = false;\n\n\tlet editing = false;\n\tlet streaming = false;\n\n\tlet stopResponseFlag = false;\n\n\tlet inputElement = null;\n\n\tconst init = async () => {\n\t\tloading = true;\n\t\tconst res = await getNoteById(localStorage.token, id).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tmessages = [];\n\n\t\tif (res) {\n\t\t\tnote = res;\n\t\t\tfiles = res.data.files || [];\n\t\t} else {\n\t\t\tgoto('/');\n\t\t\treturn;\n\t\t}\n\n\t\tloading = false;\n\t};\n\n\tlet debounceTimeout: NodeJS.Timeout | null = null;\n\n\tconst changeDebounceHandler = () => {\n\t\tif (debounceTimeout) {\n\t\t\tclearTimeout(debounceTimeout);\n\t\t}\n\n\t\tdebounceTimeout = setTimeout(async () => {\n\t\t\tconst res = await updateNoteById(localStorage.token, id, {\n\t\t\t\ttitle: note?.title === '' ? $i18n.t('Untitled') : note.title,\n\t\t\t\tdata: {\n\t\t\t\t\tfiles: files\n\t\t\t\t},\n\t\t\t\taccess_control: note?.access_control\n\t\t\t}).catch((e) => {\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t});\n\t\t}, 200);\n\t};\n\n\t$: if (id) {\n\t\tinit();\n\t}\n\n\tfunction areContentsEqual(a, b) {\n\t\treturn JSON.stringify(a) === JSON.stringify(b);\n\t}\n\n\tfunction insertNoteVersion(note) {\n\t\tconst current = {\n\t\t\tjson: note.data.content.json,\n\t\t\thtml: note.data.content.html,\n\t\t\tmd: note.data.content.md\n\t\t};\n\t\tconst lastVersion = note.data.versions?.at(-1);\n\n\t\tif (!lastVersion || !areContentsEqual(lastVersion, current)) {\n\t\t\tnote.data.versions = (note.data.versions ?? []).concat(current);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tconst onEdited = async () => {\n\t\tif (!editor) return;\n\t\teditor.commands.setContent(note.data.content.html);\n\t};\n\n\tconst generateTitleHandler = async () => {\n\t\tconst content = note.data.content.md;\n\t\tconst DEFAULT_TITLE_GENERATION_PROMPT_TEMPLATE = `### Task:\nGenerate a concise, 3-5 word title with an emoji summarizing the content in the content's primary language.\n### Guidelines:\n- The title should clearly represent the main theme or subject of the content.\n- Use emojis that enhance understanding of the topic, but avoid quotation marks or special formatting.\n- Write the title in the content's primary language.\n- Prioritize accuracy over excessive creativity; keep it clear and simple.\n- Your entire response must consist solely of the JSON object, without any introductory or concluding text.\n- The output must be a single, raw JSON object, without any markdown code fences or other encapsulating text.\n- Ensure no conversational text, affirmations, or explanations precede or follow the raw JSON output, as this will cause direct parsing failure.\n### Output:\nJSON format: { \"title\": \"your concise title here\" }\n### Examples:\n- { \"title\": \"📉 Stock Market Trends\" },\n- { \"title\": \"🍪 Perfect Chocolate Chip Recipe\" },\n- { \"title\": \"Evolution of Music Streaming\" },\n- { \"title\": \"Remote Work Productivity Tips\" },\n- { \"title\": \"Artificial Intelligence in Healthcare\" },\n- { \"title\": \"🎮 Video Game Development Insights\" }\n### Content:\n<content>\n${content}\n</content>`;\n\n\t\tconst oldTitle = JSON.parse(JSON.stringify(note.title));\n\t\tnote.title = '';\n\t\ttitleGenerating = true;\n\n\t\tconst res = await generateOpenAIChatCompletion(\n\t\t\tlocalStorage.token,\n\t\t\t{\n\t\t\t\tmodel: selectedModelId,\n\t\t\t\tstream: false,\n\t\t\t\tmessages: [\n\t\t\t\t\t{\n\t\t\t\t\t\trole: 'user',\n\t\t\t\t\t\tcontent: DEFAULT_TITLE_GENERATION_PROMPT_TEMPLATE\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\t`${WEBUI_BASE_URL}/api`\n\t\t);\n\t\tif (res) {\n\t\t\t// Step 1: Safely extract the response string\n\t\t\tconst response = res?.choices[0]?.message?.content ?? '';\n\n\t\t\ttry {\n\t\t\t\tconst jsonStartIndex = response.indexOf('{');\n\t\t\t\tconst jsonEndIndex = response.lastIndexOf('}');\n\n\t\t\t\tif (jsonStartIndex !== -1 && jsonEndIndex !== -1) {\n\t\t\t\t\tconst jsonResponse = response.substring(jsonStartIndex, jsonEndIndex + 1);\n\t\t\t\t\tconst parsed = JSON.parse(jsonResponse);\n\n\t\t\t\t\tif (parsed && parsed.title) {\n\t\t\t\t\t\tnote.title = parsed.title.trim();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Error parsing JSON response:', e);\n\t\t\t\ttoast.error($i18n.t('Failed to generate title'));\n\t\t\t}\n\t\t}\n\n\t\tif (!note.title) {\n\t\t\tnote.title = oldTitle;\n\t\t}\n\n\t\ttitleGenerating = false;\n\t\tawait tick();\n\t\tchangeDebounceHandler();\n\t};\n\n\tasync function enhanceNoteHandler() {\n\t\tif (selectedModelId === '') {\n\t\t\ttoast.error($i18n.t('Please select a model.'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = $models\n\t\t\t.filter((model) => model.id === selectedModelId && !(model?.info?.meta?.hidden ?? false))\n\t\t\t.find((model) => model.id === selectedModelId);\n\n\t\tif (!model) {\n\t\t\tselectedModelId = '';\n\t\t\treturn;\n\t\t}\n\n\t\tediting = true;\n\t\tawait enhanceCompletionHandler(model);\n\t\tediting = false;\n\n\t\tonEdited();\n\t\tversionIdx = null;\n\t}\n\n\tconst stopResponseHandler = async () => {\n\t\tstopResponseFlag = true;\n\t\tconsole.log('stopResponse', stopResponseFlag);\n\t};\n\n\tfunction setContentByVersion(versionIdx) {\n\t\tif (!note.data.versions?.length) return;\n\t\tlet idx = versionIdx;\n\n\t\tif (idx === null) idx = note.data.versions.length - 1; // latest\n\t\tconst v = note.data.versions[idx];\n\n\t\tnote.data.content.json = v.json;\n\t\tnote.data.content.html = v.html;\n\t\tnote.data.content.md = v.md;\n\n\t\tif (versionIdx === null) {\n\t\t\tconst lastVersion = note.data.versions.at(-1);\n\t\t\tconst currentContent = note.data.content;\n\n\t\t\tif (areContentsEqual(lastVersion, currentContent)) {\n\t\t\t\t// remove the last version\n\t\t\t\tnote.data.versions = note.data.versions.slice(0, -1);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Navigation\n\tfunction versionNavigateHandler(direction) {\n\t\tif (!note.data.versions || note.data.versions.length === 0) return;\n\n\t\tif (versionIdx === null) {\n\t\t\t// Get latest snapshots\n\t\t\tconst lastVersion = note.data.versions.at(-1);\n\t\t\tconst currentContent = note.data.content;\n\n\t\t\tif (!areContentsEqual(lastVersion, currentContent)) {\n\t\t\t\t// If the current content is different from the last version, insert a new version\n\t\t\t\tinsertNoteVersion(note);\n\t\t\t\tversionIdx = note.data.versions.length - 1;\n\t\t\t} else {\n\t\t\t\tversionIdx = note.data.versions.length;\n\t\t\t}\n\t\t}\n\n\t\tif (direction === 'prev') {\n\t\t\tif (versionIdx > 0) versionIdx -= 1;\n\t\t} else if (direction === 'next') {\n\t\t\tif (versionIdx < note.data.versions.length - 1) versionIdx += 1;\n\t\t\telse versionIdx = null; // Reset to latest\n\n\t\t\tif (versionIdx === note.data.versions.length - 1) {\n\t\t\t\t// If we reach the latest version, reset to null\n\t\t\t\tversionIdx = null;\n\t\t\t}\n\t\t}\n\n\t\tsetContentByVersion(versionIdx);\n\t}\n\n\tconst uploadFileHandler = async (file) => {\n\t\tconst tempItemId = uuidv4();\n\t\tconst fileItem = {\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: '',\n\t\t\tname: file.name,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\tsize: file.size,\n\t\t\terror: '',\n\t\t\titemId: tempItemId\n\t\t};\n\n\t\tif (fileItem.size == 0) {\n\t\t\ttoast.error($i18n.t('You cannot upload an empty file.'));\n\t\t\treturn null;\n\t\t}\n\n\t\tfiles = [...files, fileItem];\n\n\t\ttry {\n\t\t\t// If the file is an audio file, provide the language for STT.\n\t\t\tlet metadata = null;\n\t\t\tif (\n\t\t\t\t(file.type.startsWith('audio/') || file.type.startsWith('video/')) &&\n\t\t\t\t$settings?.audio?.stt?.language\n\t\t\t) {\n\t\t\t\tmetadata = {\n\t\t\t\t\tlanguage: $settings?.audio?.stt?.language\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// During the file upload, file content is automatically extracted.\n\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file, metadata);\n\n\t\t\tif (uploadedFile) {\n\t\t\t\tconsole.log('File upload completed:', {\n\t\t\t\t\tid: uploadedFile.id,\n\t\t\t\t\tname: fileItem.name,\n\t\t\t\t\tcollection: uploadedFile?.meta?.collection_name\n\t\t\t\t});\n\n\t\t\t\tif (uploadedFile.error) {\n\t\t\t\t\tconsole.warn('File upload warning:', uploadedFile.error);\n\t\t\t\t\ttoast.warning(uploadedFile.error);\n\t\t\t\t}\n\n\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\tfileItem.file = uploadedFile;\n\t\t\t\tfileItem.id = uploadedFile.id;\n\t\t\t\tfileItem.collection_name =\n\t\t\t\t\tuploadedFile?.meta?.collection_name || uploadedFile?.collection_name;\n\n\t\t\t\tfileItem.url = `${WEBUI_API_BASE_URL}/files/${uploadedFile.id}`;\n\n\t\t\t\tfiles = files;\n\t\t\t} else {\n\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\ttoast.error(`${e}`);\n\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t}\n\n\t\tif (files.length > 0) {\n\t\t\tnote.data.files = files;\n\t\t} else {\n\t\t\tnote.data.files = null;\n\t\t}\n\n\t\tchangeDebounceHandler();\n\t};\n\n\tconst inputFilesHandler = async (inputFiles) => {\n\t\tconsole.log('Input files handler called with:', inputFiles);\n\t\tinputFiles.forEach(async (file) => {\n\t\t\tconsole.log('Processing file:', {\n\t\t\t\tname: file.name,\n\t\t\t\ttype: file.type,\n\t\t\t\tsize: file.size,\n\t\t\t\textension: file.name.split('.').at(-1)\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\t($config?.file?.max_size ?? null) !== null &&\n\t\t\t\tfile.size > ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t) {\n\t\t\t\tconsole.log('File exceeds max size limit:', {\n\t\t\t\t\tfileSize: file.size,\n\t\t\t\t\tmaxSize: ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t\t});\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t(`File size should not exceed {{maxSize}} MB.`, {\n\t\t\t\t\t\tmaxSize: $config?.file?.max_size\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file['type'].startsWith('image/')) {\n\t\t\t\tconst compressImageHandler = async (imageUrl, settings = {}, config = {}) => {\n\t\t\t\t\t// Quick shortcut so we don’t do unnecessary work.\n\t\t\t\t\tconst settingsCompression = settings?.imageCompression ?? false;\n\t\t\t\t\tconst configWidth = config?.file?.image_compression?.width ?? null;\n\t\t\t\t\tconst configHeight = config?.file?.image_compression?.height ?? null;\n\n\t\t\t\t\t// If neither settings nor config wants compression, return original URL.\n\t\t\t\t\tif (!settingsCompression && !configWidth && !configHeight) {\n\t\t\t\t\t\treturn imageUrl;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Default to null (no compression unless set)\n\t\t\t\t\tlet width = null;\n\t\t\t\t\tlet height = null;\n\n\t\t\t\t\t// If user/settings want compression, pick their preferred size.\n\t\t\t\t\tif (settingsCompression) {\n\t\t\t\t\t\twidth = settings?.imageCompressionSize?.width ?? null;\n\t\t\t\t\t\theight = settings?.imageCompressionSize?.height ?? null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Apply config limits as an upper bound if any\n\t\t\t\t\tif (configWidth && (width === null || width > configWidth)) {\n\t\t\t\t\t\twidth = configWidth;\n\t\t\t\t\t}\n\t\t\t\t\tif (configHeight && (height === null || height > configHeight)) {\n\t\t\t\t\t\theight = configHeight;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Do the compression if required\n\t\t\t\t\tif (width || height) {\n\t\t\t\t\t\treturn await compressImage(imageUrl, width, height);\n\t\t\t\t\t}\n\t\t\t\t\treturn imageUrl;\n\t\t\t\t};\n\n\t\t\t\tlet reader = new FileReader();\n\t\t\t\treader.onload = async (event) => {\n\t\t\t\t\tlet imageUrl = event.target.result;\n\n\t\t\t\t\timageUrl = await compressImageHandler(imageUrl, $settings, $config);\n\n\t\t\t\t\tfiles = [\n\t\t\t\t\t\t...files,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: `${imageUrl}`\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t\tnote.data.files = files;\n\t\t\t\t};\n\t\t\t\treader.readAsDataURL(\n\t\t\t\t\tfile['type'] === 'image/heic'\n\t\t\t\t\t\t? await heic2any({ blob: file, toType: 'image/jpeg' })\n\t\t\t\t\t\t: file\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tuploadFileHandler(file);\n\t\t\t}\n\t\t});\n\t};\n\n\tconst downloadHandler = async (type) => {\n\t\tconsole.log('downloadHandler', type);\n\t\tif (type === 'txt') {\n\t\t\tconst blob = new Blob([note.data.content.md], { type: 'text/plain' });\n\t\t\tsaveAs(blob, `${note.title}.txt`);\n\t\t} else if (type === 'md') {\n\t\t\tconst blob = new Blob([note.data.content.md], { type: 'text/markdown' });\n\t\t\tsaveAs(blob, `${note.title}.md`);\n\t\t} else if (type === 'pdf') {\n\t\t\tawait downloadPdf(note);\n\t\t}\n\t};\n\n\tconst downloadPdf = async (note) => {\n\t\ttry {\n\t\t\t// Define a fixed virtual screen size\n\t\t\tconst virtualWidth = 1024; // Fixed width (adjust as needed)\n\t\t\tconst virtualHeight = 1400; // Fixed height (adjust as needed)\n\n\t\t\t// STEP 1. Get a DOM node to render\n\t\t\tconst html = note.data?.content?.html ?? '';\n\t\t\tlet node;\n\t\t\tif (html instanceof HTMLElement) {\n\t\t\t\tnode = html;\n\t\t\t} else {\n\t\t\t\t// If it's HTML string, render to a temporary hidden element\n\t\t\t\tnode = document.createElement('div');\n\t\t\t\tnode.innerHTML = html;\n\t\t\t\tdocument.body.appendChild(node);\n\t\t\t}\n\n\t\t\t// Render to canvas with predefined width\n\t\t\tconst canvas = await html2canvas(node, {\n\t\t\t\tuseCORS: true,\n\t\t\t\tscale: 2, // Keep at 1x to avoid unexpected enlargements\n\t\t\t\twidth: virtualWidth, // Set fixed virtual screen width\n\t\t\t\twindowWidth: virtualWidth, // Ensure consistent rendering\n\t\t\t\twindowHeight: virtualHeight\n\t\t\t});\n\n\t\t\t// Remove hidden node if needed\n\t\t\tif (!(html instanceof HTMLElement)) {\n\t\t\t\tdocument.body.removeChild(node);\n\t\t\t}\n\n\t\t\tconst imgData = canvas.toDataURL('image/png');\n\n\t\t\t// A4 page settings\n\t\t\tconst pdf = new jsPDF('p', 'mm', 'a4');\n\t\t\tconst imgWidth = 210; // A4 width in mm\n\t\t\tconst pageHeight = 297; // A4 height in mm\n\n\t\t\t// Maintain aspect ratio\n\t\t\tconst imgHeight = (canvas.height * imgWidth) / canvas.width;\n\t\t\tlet heightLeft = imgHeight;\n\t\t\tlet position = 0;\n\n\t\t\tpdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n\t\t\theightLeft -= pageHeight;\n\n\t\t\t// Handle additional pages\n\t\t\twhile (heightLeft > 0) {\n\t\t\t\tposition -= pageHeight;\n\t\t\t\tpdf.addPage();\n\n\t\t\t\tpdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n\t\t\t\theightLeft -= pageHeight;\n\t\t\t}\n\n\t\t\tpdf.save(`${note.title}.pdf`);\n\t\t} catch (error) {\n\t\t\tconsole.error('Error generating PDF', error);\n\n\t\t\ttoast.error(`${error}`);\n\t\t}\n\t};\n\n\tconst deleteNoteHandler = async (id) => {\n\t\tconst res = await deleteNoteById(localStorage.token, id).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Note deleted successfully'));\n\t\t\tgoto('/notes');\n\t\t} else {\n\t\t\ttoast.error($i18n.t('Failed to delete note'));\n\t\t}\n\t};\n\n\tconst scrollToBottom = () => {\n\t\tconst element = document.getElementById('note-content-container');\n\n\t\tif (element) {\n\t\t\telement.scrollTop = element?.scrollHeight;\n\t\t}\n\t};\n\n\tconst enhanceCompletionHandler = async (model) => {\n\t\tstopResponseFlag = false;\n\t\tlet enhancedContent = {\n\t\t\tjson: null,\n\t\t\thtml: '',\n\t\t\tmd: ''\n\t\t};\n\n\t\tconst systemPrompt = `Enhance existing notes using additional context provided from audio transcription or uploaded file content in the content's primary language. Your task is to make the notes more useful and comprehensive by incorporating relevant information from the provided context.\n\nInput will be provided within <notes> and <context> XML tags, providing a structure for the existing notes and context respectively.\n\n# Output Format\n\nProvide the enhanced notes in markdown format. Use markdown syntax for headings, lists, task lists ([ ]) where tasks or checklists are strongly implied, and emphasis to improve clarity and presentation. Ensure that all integrated content from the context is accurately reflected. Return only the markdown formatted note.\n`;\n\n\t\tconst [res, controller] = await chatCompletion(\n\t\t\tlocalStorage.token,\n\t\t\t{\n\t\t\t\tmodel: model.id,\n\t\t\t\tstream: true,\n\t\t\t\tmessages: [\n\t\t\t\t\t{\n\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\tcontent: systemPrompt\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\trole: 'user',\n\t\t\t\t\t\tcontent:\n\t\t\t\t\t\t\t`<notes>${note.data.content.md}</notes>` +\n\t\t\t\t\t\t\t(files && files.length > 0\n\t\t\t\t\t\t\t\t? `\\n<context>${files.map((file) => `${file.name}: ${file?.file?.data?.content ?? 'Could not extract content'}\\n`).join('')}</context>`\n\t\t\t\t\t\t\t\t: '')\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\t`${WEBUI_BASE_URL}/api`\n\t\t);\n\n\t\tawait tick();\n\n\t\tstreaming = true;\n\n\t\tif (res && res.ok) {\n\t\t\tconst reader = res.body\n\t\t\t\t.pipeThrough(new TextDecoderStream())\n\t\t\t\t.pipeThrough(splitStream('\\n'))\n\t\t\t\t.getReader();\n\n\t\t\twhile (true) {\n\t\t\t\tconst { value, done } = await reader.read();\n\t\t\t\tif (done || stopResponseFlag) {\n\t\t\t\t\tif (stopResponseFlag) {\n\t\t\t\t\t\tcontroller.abort('User: Stop Response');\n\t\t\t\t\t}\n\n\t\t\t\t\tediting = false;\n\t\t\t\t\tstreaming = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet lines = value.split('\\n');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line !== '') {\n\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\tif (line === 'data: [DONE]') {\n\t\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlet data = JSON.parse(line.replace(/^data: /, ''));\n\t\t\t\t\t\t\t\tconsole.log(data);\n\n\t\t\t\t\t\t\t\tif (data.choices && data.choices.length > 0) {\n\t\t\t\t\t\t\t\t\tconst choice = data.choices[0];\n\t\t\t\t\t\t\t\t\tif (choice.delta && choice.delta.content) {\n\t\t\t\t\t\t\t\t\t\tenhancedContent.md += choice.delta.content;\n\t\t\t\t\t\t\t\t\t\tenhancedContent.html = marked.parse(enhancedContent.md);\n\n\t\t\t\t\t\t\t\t\t\tnote.data.content.md = enhancedContent.md;\n\t\t\t\t\t\t\t\t\t\tnote.data.content.html = enhancedContent.html;\n\t\t\t\t\t\t\t\t\t\tnote.data.content.json = null;\n\n\t\t\t\t\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tstreaming = false;\n\t};\n\n\tconst onDragOver = (e) => {\n\t\te.preventDefault();\n\n\t\t// Check if a file is being dragged.\n\t\tif (e.dataTransfer?.types?.includes('Files')) {\n\t\t\tdragged = true;\n\t\t} else {\n\t\t\tdragged = false;\n\t\t}\n\t};\n\n\tconst onDragLeave = () => {\n\t\tdragged = false;\n\t};\n\n\tconst onDrop = async (e) => {\n\t\te.preventDefault();\n\t\tconsole.log(e);\n\n\t\tif (e.dataTransfer?.files) {\n\t\t\tconst inputFiles = Array.from(e.dataTransfer?.files);\n\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\tconsole.log(inputFiles);\n\t\t\t\tinputFilesHandler(inputFiles);\n\t\t\t}\n\t\t}\n\n\t\tdragged = false;\n\t};\n\n\tconst insertHandler = (content) => {\n\t\tinsertNoteVersion(note);\n\t\tinputElement?.insertContent(content);\n\t};\n\n\tonMount(async () => {\n\t\tawait tick();\n\n\t\tif ($settings?.models) {\n\t\t\tselectedModelId = $settings?.models[0];\n\t\t} else if ($config?.default_models) {\n\t\t\tselectedModelId = $config?.default_models.split(',')[0];\n\t\t} else {\n\t\t\tselectedModelId = '';\n\t\t}\n\n\t\tif (selectedModelId) {\n\t\t\tconst model = $models\n\t\t\t\t.filter((model) => model.id === selectedModelId && !(model?.info?.meta?.hidden ?? false))\n\t\t\t\t.find((model) => model.id === selectedModelId);\n\n\t\t\tif (!model) {\n\t\t\t\tselectedModelId = '';\n\t\t\t}\n\t\t}\n\n\t\tif (!selectedModelId) {\n\t\t\tselectedModelId = $models.at(0)?.id || '';\n\t\t}\n\n\t\tconst dropzoneElement = document.getElementById('note-editor');\n\n\t\tdropzoneElement?.addEventListener('dragover', onDragOver);\n\t\tdropzoneElement?.addEventListener('drop', onDrop);\n\t\tdropzoneElement?.addEventListener('dragleave', onDragLeave);\n\t});\n\n\tonDestroy(() => {\n\t\tconsole.log('destroy');\n\t\tconst dropzoneElement = document.getElementById('note-editor');\n\n\t\tif (dropzoneElement) {\n\t\t\tdropzoneElement?.removeEventListener('dragover', onDragOver);\n\t\t\tdropzoneElement?.removeEventListener('drop', onDrop);\n\t\t\tdropzoneElement?.removeEventListener('dragleave', onDragLeave);\n\t\t}\n\t});\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{note?.title\n\t\t\t? `${note?.title.length > 30 ? `${note?.title.slice(0, 30)}...` : note?.title} • ${$WEBUI_NAME}`\n\t\t\t: `${$WEBUI_NAME}`}\n\t</title>\n</svelte:head>\n\n{#if note}\n\t<AccessControlModal\n\t\tbind:show={showAccessControlModal}\n\t\tbind:accessControl={note.access_control}\n\t\taccessRoles={['read', 'write']}\n\t\tonChange={() => {\n\t\t\tchangeDebounceHandler();\n\t\t}}\n\t/>\n{/if}\n\n<FilesOverlay show={dragged} />\n\n<DeleteConfirmDialog\n\tbind:show={showDeleteConfirm}\n\ttitle={$i18n.t('Delete note?')}\n\ton:confirm={() => {\n\t\tdeleteNoteHandler(note.id);\n\t\tshowDeleteConfirm = false;\n\t}}\n>\n\t<div class=\" text-sm text-gray-500\">\n\t\t{$i18n.t('This will delete')} <span class=\"  font-semibold\">{note.title}</span>.\n\t</div>\n</DeleteConfirmDialog>\n\n<PaneGroup direction=\"horizontal\" class=\"w-full h-full\">\n\t<Pane defaultSize={70} minSize={30} class=\"h-full flex flex-col w-full relative\">\n\t\t<div class=\"relative flex-1 w-full h-full flex justify-center pt-[11px]\" id=\"note-editor\">\n\t\t\t{#if loading}\n\t\t\t\t<div class=\" absolute top-0 bottom-0 left-0 right-0 flex\">\n\t\t\t\t\t<div class=\"m-auto\">\n\t\t\t\t\t\t<Spinner className=\"size-5\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\" w-full flex flex-col {loading ? 'opacity-20' : ''}\">\n\t\t\t\t\t<div class=\"shrink-0 w-full flex justify-between items-center px-3.5 mb-1.5\">\n\t\t\t\t\t\t<div class=\"w-full flex items-center\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"{$showSidebar\n\t\t\t\t\t\t\t\t\t? 'md:hidden pl-0.5'\n\t\t\t\t\t\t\t\t\t: ''} flex flex-none items-center pr-1 -translate-x-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"sidebar-toggle-button\"\n\t\t\t\t\t\t\t\t\tclass=\"cursor-pointer p-1.5 flex rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tshowSidebar.set(!$showSidebar);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\taria-label=\"Toggle Sidebar\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t\t<MenuLines />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclass=\"w-full text-2xl font-medium bg-transparent outline-hidden\"\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tbind:value={note.title}\n\t\t\t\t\t\t\t\tplaceholder={titleGenerating ? $i18n.t('Generating...') : $i18n.t('Title')}\n\t\t\t\t\t\t\t\tdisabled={(note?.user_id !== $user?.id && $user?.role !== 'admin') ||\n\t\t\t\t\t\t\t\t\ttitleGenerating}\n\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\ton:input={changeDebounceHandler}\n\t\t\t\t\t\t\t\ton:focus={() => {\n\t\t\t\t\t\t\t\t\ttitleInputFocused = true;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\ton:blur={(e) => {\n\t\t\t\t\t\t\t\t\t// check if target is generate button\n\t\t\t\t\t\t\t\t\tif (e.relatedTarget?.id === 'generate-title-button') {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\ttitleInputFocused = false;\n\t\t\t\t\t\t\t\t\tchangeDebounceHandler();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t{#if titleInputFocused && !titleGenerating}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"flex self-center items-center space-x-1.5 z-10 translate-y-[0.5px] -translate-x-[0.5px] pl-2\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Generate')}>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\" self-center dark:hover:text-white transition\"\n\t\t\t\t\t\t\t\t\t\t\tid=\"generate-title-button\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\t\t\t\t\t\t\t\tgenerateTitleHandler();\n\t\t\t\t\t\t\t\t\t\t\t\ttitleInputFocused = false;\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Sparkles strokeWidth=\"2\" />\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<div class=\"flex items-center gap-0.5 translate-x-1\">\n\t\t\t\t\t\t\t\t{#if editor}\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-0.5 self-center min-w-fit\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:enabled:bg-black/5 dark:hover:enabled:bg-white/5 dark:hover:enabled:text-white hover:enabled:text-black rounded-md transition disabled:cursor-not-allowed disabled:text-gray-500 disabled:hover:text-gray-500\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\teditor.chain().focus().undo().run();\n\t\t\t\t\t\t\t\t\t\t\t\t\t// versionNavigateHandler('prev');\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={!editor.can().undo()}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<ArrowUturnLeft className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:enabled:bg-black/5 dark:hover:enabled:bg-white/5 dark:hover:enabled:text-white hover:enabled:text-black rounded-md transition disabled:cursor-not-allowed disabled:text-gray-500 disabled:hover:text-gray-500\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\teditor.chain().focus().redo().run();\n\t\t\t\t\t\t\t\t\t\t\t\t\t// versionNavigateHandler('next');\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={!editor.can().redo()}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<ArrowUturnRight className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t<Tooltip placement=\"top\" content={$i18n.t('Chat')} className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"p-1.5 bg-transparent hover:bg-white/5 transition rounded-lg\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tif (showPanel && selectedPanel === 'chat') {\n\t\t\t\t\t\t\t\t\t\t\t\tshowPanel = false;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tif (!showPanel) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowPanel = true;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tselectedPanel = 'chat';\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<ChatBubbleOval />\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t<Tooltip placement=\"top\" content={$i18n.t('Settings')} className=\"cursor-pointer\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"p-1.5 bg-transparent hover:bg-white/5 transition rounded-lg\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tif (showPanel && selectedPanel === 'settings') {\n\t\t\t\t\t\t\t\t\t\t\t\tshowPanel = false;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tif (!showPanel) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowPanel = true;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tselectedPanel = 'settings';\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Cog6 />\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t<NoteMenu\n\t\t\t\t\t\t\t\t\tonDownload={(type) => {\n\t\t\t\t\t\t\t\t\t\tdownloadHandler(type);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tonCopyLink={async () => {\n\t\t\t\t\t\t\t\t\t\tconst baseUrl = window.location.origin;\n\t\t\t\t\t\t\t\t\t\tconst res = await copyToClipboard(`${baseUrl}/notes/${note.id}`);\n\n\t\t\t\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\t\t\t\ttoast.success($i18n.t('Copied link to clipboard'));\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Failed to copy link'));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tonCopyToClipboard={async () => {\n\t\t\t\t\t\t\t\t\t\tconst res = await copyToClipboard(note.data.content.md).catch((error) => {\n\t\t\t\t\t\t\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\t\t\t\ttoast.success($i18n.t('Copied to clipboard'));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tonDelete={() => {\n\t\t\t\t\t\t\t\t\t\tshowDeleteConfirm = true;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"p-1 bg-transparent hover:bg-white/5 transition rounded-lg\">\n\t\t\t\t\t\t\t\t\t\t<EllipsisHorizontal className=\"size-5\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</NoteMenu>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"  px-2.5\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" flex w-full bg-transparent overflow-x-auto scrollbar-none\"\n\t\t\t\t\t\t\ton:wheel={(e) => {\n\t\t\t\t\t\t\t\tif (e.deltaY !== 0) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\te.currentTarget.scrollLeft += e.deltaY;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"flex gap-1 items-center text-xs font-medium text-gray-500 dark:text-gray-500 w-fit\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<button class=\" flex items-center gap-1 w-fit py-1 px-1.5 rounded-lg min-w-fit\">\n\t\t\t\t\t\t\t\t\t<Calendar className=\"size-3.5\" strokeWidth=\"2\" />\n\n\t\t\t\t\t\t\t\t\t<!-- check for same date, yesterday, last week, and other -->\n\n\t\t\t\t\t\t\t\t\t{#if dayjs(note.created_at / 1000000).isSame(dayjs(), 'day')}\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t>{dayjs(note.created_at / 1000000).format($i18n.t('[Today at] h:mm A'))}</span\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{:else if dayjs(note.created_at / 1000000).isSame(dayjs().subtract(1, 'day'), 'day')}\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t>{dayjs(note.created_at / 1000000).format(\n\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('[Yesterday at] h:mm A')\n\t\t\t\t\t\t\t\t\t\t\t)}</span\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{:else if dayjs(note.created_at / 1000000).isSame(dayjs().subtract(1, 'week'), 'week')}\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t>{dayjs(note.created_at / 1000000).format(\n\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('[Last] dddd [at] h:mm A')\n\t\t\t\t\t\t\t\t\t\t\t)}</span\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<span>{dayjs(note.created_at / 1000000).format($i18n.t('DD/MM/YYYY'))}</span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\" flex items-center gap-1 w-fit py-1 px-1.5 rounded-lg min-w-fit\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tshowAccessControlModal = true;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tdisabled={note?.user_id !== $user?.id && $user?.role !== 'admin'}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Users className=\"size-3.5\" strokeWidth=\"2\" />\n\n\t\t\t\t\t\t\t\t\t<span> {note?.access_control ? $i18n.t('Private') : $i18n.t('Everyone')} </span>\n\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t{#if editor}\n\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-1 px-1 min-w-fit\">\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('{{COUNT}} words', {\n\t\t\t\t\t\t\t\t\t\t\t\tCOUNT: wordCount\n\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('{{COUNT}} characters', {\n\t\t\t\t\t\t\t\t\t\t\t\tCOUNT: charCount\n\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" flex-1 w-full h-full overflow-auto px-3.5 pb-20 relative pt-2.5\"\n\t\t\t\t\t\tid=\"note-content-container\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if editing}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"w-full h-full fixed top-0 left-0 {streaming\n\t\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t\t: ' backdrop-blur-xs  bg-white/10 dark:bg-gray-900/10'} flex items-center justify-center z-10 cursor-not-allowed\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if files && files.length > 0}\n\t\t\t\t\t\t\t<div class=\"mb-2.5 w-full flex gap-1 flex-wrap z-40\">\n\t\t\t\t\t\t\t\t{#each files as file, fileIdx}\n\t\t\t\t\t\t\t\t\t<div class=\"w-fit\">\n\t\t\t\t\t\t\t\t\t\t{#if file.type === 'image'}\n\t\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={file.url}\n\t\t\t\t\t\t\t\t\t\t\t\timageClassName=\" max-h-96 rounded-lg\"\n\t\t\t\t\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\t\t\t\t\tonDismiss={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files.filter((item, idx) => idx !== fileIdx);\n\t\t\t\t\t\t\t\t\t\t\t\t\tnote.data.files = files.length > 0 ? files : null;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\t\t\t\t\turl={file.url}\n\t\t\t\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\t\t\t\t\tloading={file.status === 'uploading'}\n\t\t\t\t\t\t\t\t\t\t\t\ton:dismiss={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files.filter((item) => item?.id !== file.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\tnote.data.files = files.length > 0 ? files : null;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<RichTextInput\n\t\t\t\t\t\t\tbind:this={inputElement}\n\t\t\t\t\t\t\tbind:editor\n\t\t\t\t\t\t\tclassName=\"input-prose-sm px-0.5\"\n\t\t\t\t\t\t\tjson={true}\n\t\t\t\t\t\t\tbind:value={note.data.content.json}\n\t\t\t\t\t\t\thtml={note.data?.content?.html}\n\t\t\t\t\t\t\tdocumentId={`note:${note.id}`}\n\t\t\t\t\t\t\tcollaboration={true}\n\t\t\t\t\t\t\tsocket={$socket}\n\t\t\t\t\t\t\tuser={$user}\n\t\t\t\t\t\t\tlink={true}\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Write something...')}\n\t\t\t\t\t\t\teditable={versionIdx === null && !editing}\n\t\t\t\t\t\t\tonChange={(content) => {\n\t\t\t\t\t\t\t\tnote.data.content.html = content.html;\n\t\t\t\t\t\t\t\tnote.data.content.md = content.md;\n\n\t\t\t\t\t\t\t\tif (editor) {\n\t\t\t\t\t\t\t\t\twordCount = editor.storage.characterCount.words();\n\t\t\t\t\t\t\t\t\tcharCount = editor.storage.characterCount.characters();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t\t<div class=\"absolute z-20 bottom-0 right-0 p-3.5 max-w-full w-full flex\">\n\t\t\t<div class=\"flex gap-1 w-full min-w-full justify-between\">\n\t\t\t\t{#if recording}\n\t\t\t\t\t<div class=\"flex-1 w-full\">\n\t\t\t\t\t\t<VoiceRecording\n\t\t\t\t\t\t\tbind:recording\n\t\t\t\t\t\t\tclassName=\"p-1 w-full max-w-full\"\n\t\t\t\t\t\t\ttranscribe={false}\n\t\t\t\t\t\t\tdisplayMedia={displayMediaRecord}\n\t\t\t\t\t\t\techoCancellation={false}\n\t\t\t\t\t\t\tnoiseSuppression={false}\n\t\t\t\t\t\t\tonCancel={() => {\n\t\t\t\t\t\t\t\trecording = false;\n\t\t\t\t\t\t\t\tdisplayMediaRecord = false;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonConfirm={(data) => {\n\t\t\t\t\t\t\t\tif (data?.file) {\n\t\t\t\t\t\t\t\t\tuploadFileHandler(data?.file);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\trecording = false;\n\t\t\t\t\t\t\t\tdisplayMediaRecord = false;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<RecordMenu\n\t\t\t\t\t\tonRecord={async () => {\n\t\t\t\t\t\t\tdisplayMediaRecord = false;\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices\n\t\t\t\t\t\t\t\t\t.getUserMedia({ audio: true })\n\t\t\t\t\t\t\t\t\t.catch(function (err) {\n\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t$i18n.t(`Permission denied when accessing microphone: {{error}}`, {\n\t\t\t\t\t\t\t\t\t\t\t\terror: err\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\trecording = true;\n\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tstream = null;\n\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing microphone'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tonCaptureAudio={async () => {\n\t\t\t\t\t\t\tdisplayMediaRecord = true;\n\n\t\t\t\t\t\t\trecording = true;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tonUpload={async () => {\n\t\t\t\t\t\t\tconst input = document.createElement('input');\n\t\t\t\t\t\t\tinput.type = 'file';\n\t\t\t\t\t\t\tinput.accept = 'audio/*';\n\t\t\t\t\t\t\tinput.multiple = false;\n\t\t\t\t\t\t\tinput.click();\n\n\t\t\t\t\t\t\tinput.onchange = async (e) => {\n\t\t\t\t\t\t\t\tconst files = e.target.files;\n\n\t\t\t\t\t\t\t\tif (files && files.length > 0) {\n\t\t\t\t\t\t\t\t\tawait uploadFileHandler(files[0]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Record')} placement=\"top\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"cursor-pointer p-2.5 flex rounded-full border border-gray-50 bg-white dark:border-none dark:bg-gray-850 hover:bg-gray-50 dark:hover:bg-gray-800 transition shadow-xl\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<MicSolid className=\"size-4.5\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</RecordMenu>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"cursor-pointer flex gap-0.5 rounded-full border border-gray-50 dark:border-gray-850 dark:bg-gray-850 transition shadow-xl\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$i18n.t('AI')} placement=\"top\">\n\t\t\t\t\t\t\t{#if editing}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"p-2 flex justify-center items-center hover:bg-gray-50 dark:hover:bg-gray-800 rounded-full transition shrink-0\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tstopResponseHandler();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Spinner className=\"size-5\" />\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<AiMenu\n\t\t\t\t\t\t\t\t\tonEdit={() => {\n\t\t\t\t\t\t\t\t\t\tenhanceNoteHandler();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tonChat={() => {\n\t\t\t\t\t\t\t\t\t\tshowPanel = true;\n\t\t\t\t\t\t\t\t\t\tselectedPanel = 'chat';\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"cursor-pointer p-2.5 flex rounded-full border border-gray-50 bg-white dark:border-none dark:bg-gray-850 hover:bg-gray-50 dark:hover:bg-gray-800 transition shadow-xl\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<SparklesSolid />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</AiMenu>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</Pane>\n\t<NotePanel bind:show={showPanel}>\n\t\t{#if selectedPanel === 'chat'}\n\t\t\t<Chat\n\t\t\t\tbind:show={showPanel}\n\t\t\t\tbind:selectedModelId\n\t\t\t\tbind:messages\n\t\t\t\tbind:note\n\t\t\t\tbind:editing\n\t\t\t\tbind:streaming\n\t\t\t\tbind:stopResponseFlag\n\t\t\t\t{files}\n\t\t\t\tonInsert={insertHandler}\n\t\t\t\tonStop={stopResponseHandler}\n\t\t\t\t{onEdited}\n\t\t\t\tinsertNoteHandler={() => {\n\t\t\t\t\tinsertNoteVersion(note);\n\t\t\t\t}}\n\t\t\t\tscrollToBottomHandler={scrollToBottom}\n\t\t\t/>\n\t\t{:else if selectedPanel === 'settings'}\n\t\t\t<Settings bind:show={showPanel} bind:selectedModelId />\n\t\t{/if}\n\t</NotePanel>\n</PaneGroup>\n","<script lang=\"ts\">\n\timport { page } from '$app/stores';\n\timport NoteEditor from '$lib/components/notes/NoteEditor.svelte';\n</script>\n\n<div id=\"note-container\" class=\"w-full h-full\">\n\t<NoteEditor id={$page.params.id} />\n</div>\n"],"names":["ctx","dirty","pane_1_changes","create_if_block_1","insert_hydration","target","div","anchor","div1","append_hydration","div0","create_if_block_3","show","$$props","pane","containerId","mediaQuery","largeScreen","minSize","handleMediaQuery","e","onMount","container","$$invalidate","entries","entry","percentage","onDestroy","t_value","option","option_value_value","set_data","t","each_value","ensure_array_like","func","i","add_render_callback","select","div3","button","div2","div7","div6","div4","div5","t1","t1_value","t5","t5_value","model","_b","_a","i18n","getContext","selectedModelId","select_value","svg","path","className","strokeWidth","markdown_changes","textarea_props","textarea_changes","t0_value","_c","current","t0","message","idx","onDelete","onEdit","onInsert","$$self","value","each_blocks","messages","content","msg","messageIdx","span","attr","button_class_value","div12","div11","div10","div9","div8","marked","body","ordered","start","type","startatt","text","task","checked","editing","streaming","stopResponseFlag","note","files","onStop","onEdited","insertNoteHandler","scrollToBottomHandler","loading","messagesContainerElement","system","editorEnabled","chatInputElement","DEFAULT_DOCUMENT_EDITOR_PROMPT","scrolledToBottom","scrollToBottom","onScroll","chatCompletionHandler","toast","$i18n","$models","responseMessage","tick","enhancedContent","file","chatMessages","res","controller","chatCompletion","WEBUI_BASE_URL","messageContent","reader","splitStream","done","lines","line","data","deltaContent","_e","_d","error","submitHandler","$user","goto","$$value","button0","button1","button2","t4","t4_value","t7","t7_value","onRecord","onCaptureAudio","onUpload","dispatch","createEventDispatcher","fade","state","onChat","onChange","accesscontrolmodal_props","accesscontrolmodal_changes","t2_value","t2","t10_value","if_block0","create_if_block_13","create_if_block_12","dayjs","show_if_1","show_if_2","create_if_block_8","create_if_block_7","if_block5","create_if_block_5","richtextinput_props","input_1","input_1_disabled_value","_f","set_input_value","t10","_g","richtextinput_changes","_i","_h","div_class_value","fileitem_changes","image_changes","document_1","title_value","create_if_block_14","areContentsEqual","a","b","insertNoteVersion","lastVersion","saveAs","fileSaver","calendar","duration","relativeTime","loadLocale","locales","locale","id","editor","wordCount","charCount","versionIdx","recording","displayMediaRecord","showPanel","selectedPanel","showDeleteConfirm","showAccessControlModal","titleInputFocused","titleGenerating","dragged","inputElement","init","getNoteById","debounceTimeout","changeDebounceHandler","updateNoteById","generateTitleHandler","DEFAULT_TITLE_GENERATION_PROMPT_TEMPLATE","oldTitle","generateOpenAIChatCompletion","response","jsonStartIndex","jsonEndIndex","jsonResponse","parsed","enhanceNoteHandler","enhanceCompletionHandler","stopResponseHandler","uploadFileHandler","tempItemId","uuidv4","fileItem","metadata","$settings","uploadedFile","uploadFile","WEBUI_API_BASE_URL","item","inputFilesHandler","inputFiles","$config","compressImageHandler","imageUrl","settings","config","settingsCompression","configWidth","configHeight","width","height","compressImage","event","heic2any","downloadHandler","blob","downloadPdf","html","node","canvas","html2canvas","imgData","pdf","jsPDF","imgWidth","pageHeight","imgHeight","heightLeft","position","deleteNoteHandler","deleteNoteById","element","systemPrompt","choice","onDragOver","onDragLeave","onDrop","insertHandler","dropzoneElement","showSidebar","$showSidebar","baseUrl","copyToClipboard","fileIdx","stream","err","track","input"],"mappings":"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"}